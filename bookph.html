<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Photographer | DarShana</title>
<style>
  body{font-family: Arial,sans-serif;margin:0;background:#f5f7fa;}
  header{background:#004aad;color:#fff;padding:15px;text-align:center;}
  h1{margin:0;}
  .container{max-width:1000px;margin:30px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
  .photographer-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;}
  .card{padding:20px;border-radius:12px;background:#f9f9f9;text-align:center;box-shadow:0 3px 10px rgba(0,0,0,0.05);}
  .card img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:2px solid #004aad;}
  .card h3{margin:10px 0 5px;color:#004aad;}
  .card p{margin:3px 0;font-size:14px;}
  .card button{margin-top:10px;background:#004aad;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;}
  .card button:hover{background:#00307d;}
  /* Modal */
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;}
  .modal-content{background:#fff;padding:20px;border-radius:10px;max-width:400px;width:90%;position:relative;}
  .close-btn{position:absolute;top:10px;right:15px;cursor:pointer;font-size:18px;color:red;}
  label{font-weight:bold;display:block;margin-top:10px;}
  input, select, textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-top:5px;}
  button.book{background:green;margin-top:15px;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;}
  button.book:hover{background:#0b8a0b;}
  #bookingMessage{margin-top:10px;font-weight:bold;}
  a.back-link{display:inline-block;margin-bottom:15px;color:#004aad;text-decoration:none;}
  a.back-link:hover{text-decoration:underline;}
</style>
</head>
<body>

<header><h1>Book Photographer / Videomaker</h1></header>

<div class="container">
  <a href="index.html" class="back-link">&larr; Back</a>
  <h2>Available Photographers</h2>
  <div id="photographerList" class="photographer-list"><p>Loading photographers...</p></div>
</div>

<!-- Booking Modal -->
<div id="bookingModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <h3 id="modalPhotographerName"></h3>
    <p><strong>Fee: ₹<span id="modalFee">0</span></strong></p>
    <form id="bookingForm">
      <input type="hidden" id="photographerId" name="photographerId">
      
      <label for="userName">Your Full Name *</label>
      <input type="text" id="userName" name="userName" required>

      <label for="userPhone">Phone Number *</label>
      <input type="tel" id="userPhone" name="userPhone" required>

      <label for="userEmail">Email Address *</label>
      <input type="email" id="userEmail" name="userEmail" required>

      <label for="userLocation">Your Location / Area *</label>
      <input type="text" id="userLocation" name="userLocation" required>

      <label for="bookingDate">Booking Date *</label>
      <input type="date" id="bookingDate" name="bookingDate" required>

      <label for="bookingShift">Preferred Shift *</label>
      <select id="bookingShift" name="bookingShift" required>
        <option value="">Select Shift</option>
        <option>Morning</option>
        <option>Afternoon</option>
        <option>Evening</option>
        <option>Night</option>
      </select>

      <button type="submit" class="book">Pay & Confirm Booking</button>
      <p id="bookingMessage"></p>
    </form>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  // Firebase config
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBOBSih5TqSi1N_acZcAK4t2ZMy719x-7o",
  authDomain: "darshana-eac72.firebaseapp.com",
  projectId: "darshana-eac72",
  storageBucket: "darshana-eac72.appspot.com",
  messagingSenderId: "436445068467",
  appId: "1:436445068467:web:c433c2250054dd24b384c6"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


  const photographerList = document.getElementById("photographerList");
  const bookingModal = document.getElementById("bookingModal");
  const bookingForm = document.getElementById("bookingForm");
  const modalPhotographerName = document.getElementById("modalPhotographerName");
  const modalFee = document.getElementById("modalFee");
  const bookingMessage = document.getElementById("bookingMessage");

  let selectedPhotographerFee = 0;

  // Load approved photographers
  async function loadPhotographers(){
    const snapshot = await db.collection("photographers").where("approved","==",true).get();
    photographerList.innerHTML = "";
    if(snapshot.empty){
      photographerList.innerHTML="<p>No photographers available.</p>";
      return;
    }
    snapshot.forEach(doc=>{
      const p = doc.data();
      const card = document.createElement("div");
      card.className="card";
      card.innerHTML = `
        <img src="${p.photo}" alt="${p.fullName}">
        <h3>${p.fullName}</h3>
        <p><strong>Specialization:</strong> ${p.job}</p>
        <p><strong>Location:</strong> ${p.location}</p>
        <p><strong>Fees:</strong> ₹${p.fees}</p>
        <button onclick="openModal('${doc.id}','${p.fullName}','${p.fees}')">Book Now</button>
      `;
      photographerList.appendChild(card);
    });
  }

  function openModal(id,name,fee){
    document.getElementById("photographerId").value = id;
    modalPhotographerName.textContent = name;
    modalFee.textContent = fee;
    selectedPhotographerFee = fee;
    bookingModal.style.display="flex";
  }

  function closeModal(){ bookingModal.style.display="none"; }

  // Booking with dummy payment
  bookingForm.addEventListener("submit", async e=>{
    e.preventDefault();
    bookingMessage.textContent = "Processing Payment...";
    bookingMessage.style.color = "blue";

    setTimeout(async ()=>{
      const bookingData = {
        photographerId: bookingForm.photographerId.value,
        userName: bookingForm.userName.value,
        userPhone: bookingForm.userPhone.value,
        userEmail: bookingForm.userEmail.value,
        userLocation: bookingForm.userLocation.value,
        bookingDate: bookingForm.bookingDate.value,
        bookingShift: bookingForm.bookingShift.value,
        paymentStatus: "paid",
        amount: selectedPhotographerFee,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      try{
        await db.collection("bookings").add(bookingData);
        bookingMessage.textContent = "✅ Booking Confirmed! Photographer will contact you soon.";
        bookingMessage.style.color="green";
        bookingForm.reset();
        closeModal();
      }catch(err){
        console.error(err);
        bookingMessage.textContent="❌ Error! Try again.";
        bookingMessage.style.color="red";
      }
    },1500);
  });

  // Close modal on outside click
  window.onclick = e => { if(e.target===bookingModal) closeModal(); }

  loadPhotographers();
</script>

</body>
</html>
